- pipeline: "update production"
  trigger_mode: "ON_EVERY_PUSH"
  ref_name: "master"
  ref_type: "BRANCH"
  fetch_all_refs: true
  trigger_condition: "ALWAYS"
  target_site_url: "https://www.skillbill.it"
  actions:
  - action: "Execute: jekyll build"
    type: "BUILD"
    working_directory: "/srv/jekyll"
    docker_image_name: "jekyll/jekyll"
    docker_image_tag: "4.2.0"
    execute_commands:
    - echo `date`
    - "chown -R jekyll:jekyll $WORKING_DIR"
    - "bundle install"
    - "jekyll build"
    volume_mappings:
    - "/:/srv/jekyll"
    trigger_condition: "ALWAYS"
    shell: "BASH"
  - action: "Upload files"
    type: "SFTP"
    input_type: "BUILD_ARTIFACTS"
    local_path: "_site/"
    remote_path: "/var/www/html/"
    login: "root"
    host: "www.skillbill.it"
    port: "22"
    env_key: "prod_rsa"
    authentication_mode: "ENV_KEY"
  - action: "Send CD notification"
    type: "SLACK"
    content: "[#$BUDDY_EXECUTION_ID] $BUDDY_PIPELINE_NAME execution\r\n"
    channel: "C0TNK5J4T"
    channel_name: "continuous-delivery"
    attachments:
    - "{\"fallback\":\"$BUDDY_PIPELINE_NAME execution #$BUDDY_EXECUTION_ID\",\"color\":\"good\",\"fields\":[{\"title\":\"Successful execution\",\"value\":\"<$BUDDY_EXECUTION_URL|Execution #$BUDDY_EXECUTION_ID $BUDDY_EXECUTION_COMMENT>\",\"short\":true},{\"title\":\"Pipeline\",\"value\":\"<$BUDDY_PIPELINE_URL|$BUDDY_PIPELINE_NAME>\",\"short\":true},{\"title\":\"Branch\",\"value\":\"$BUDDY_EXECUTION_BRANCH\",\"short\":true},{\"title\":\"Project\",\"value\":\"<$BUDDY_PROJECT_URL|$BUDDY_PROJECT_NAME>\",\"short\":true}]}"
    trigger_condition: "ALWAYS"
    integration_hash: "secure!hsfeY1zmx5OWr28nxVEllrt2roWyLHzQJEyL2WfMO3U=.WxCZ9vMWN35cljvC67xGWA=="
